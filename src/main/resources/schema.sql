drop table ecompany if exists;
drop table edatasourceconfig if exists;
drop table emodule if exists;
drop table emoduleroles if exists;
drop table eorganization if exists;
drop table eorganizationmodules if exists;
drop table eperson if exists;
drop table eprivilege if exists;
drop table erole if exists;
drop table eroleprivileges if exists;
drop table euser if exists;
drop table euserorganizations if exists;
drop table euserroles if exists;
drop sequence if exists hibernate_sequence;

create sequence hibernate_sequence start with 1 increment by 1;

create table ecompany (id bigint generated by default as identity, name varchar(255) not null, registration varchar(255), tenant varchar(255) not null, primary key (id));
create table edatasourceconfig (id bigint generated by default as identity, dialect varchar(255) not null, driver_class_name varchar(255) not null, initialize boolean not null, name varchar(255) not null, password varchar(255), url varchar(255) not null, username varchar(255) not null, primary key (id));
create table emodule (id bigint generated by default as identity, name varchar(255) not null, primary key (id));
create table emoduleroles (module_id bigint not null, role_id varchar(255) not null, primary key (module_id, role_id));
create table eorganization (id bigint generated by default as identity, name varchar(255), company_id bigint not null, primary key (id));
create table eorganizationmodules (organization_id bigint not null, module_id bigint not null, primary key (organization_id, module_id));
create table eorganizationusers (user_id bigint not null, organization_id bigint not null);
create table eperson (id bigint generated by default as identity, document varchar(255) not null, email varchar(255) not null, name varchar(255) not null, primary key (id));
create table eprivilege (id varchar(255) not null, name varchar(255) not null, primary key (id));
create table erole (id varchar(255) not null, name varchar(255) not null, organization_id bigint, primary key (id));
create table eroleprivileges (role_id varchar(255) not null, privilege_id varchar(255) not null, primary key (role_id, privilege_id));
create table euser (id bigint generated by default as identity, password varchar(255) not null, username varchar(255) not null, person_id bigint not null, enabled boolean not null, credentialsnonexpired boolean not null, accountnonlocked boolean not null, accountnonexpired boolean not null, accesstoken_expiredate timestamp, lastlogin timestamp, primary key (id));
create table euserroles (user_id bigint not null, module_id bigint not null, role_id varchar(255) not null);

alter table euser add constraint UK_91olbrl5n7q50kaldxheq2h7y unique (person_id);
alter table emoduleroles add constraint FK88kc6poajlqvkf4e35ybsakfk foreign key (role_id) references erole;
alter table emoduleroles add constraint FKr5ptrs4x5e4i32algvb1sao90 foreign key (module_id) references emodule;
alter table eorganization add constraint FKkdlrjccrphe7abk4o7ddrgkln foreign key (company_id) references ecompany;
alter table eorganizationmodules add constraint FKn1c7fvp4kao9m08us543l4qyo foreign key (module_id) references emodule;
alter table eorganizationmodules add constraint FKryb2ukl5gw45pce8b18r75939 foreign key (organization_id) references eorganization;
alter table eorganizationusers add constraint FK8fdv2re5xmno7jra139aywxf2 foreign key (organization_id) references eorganization;
alter table eorganizationusers add constraint FKmmjg29mg1drofeysyya7s8vv0 foreign key (user_id) references euser;
alter table erole add constraint FK6e2lccxtihinu30dojlana7rc foreign key (organization_id) references eorganization;
alter table eroleprivileges add constraint FK7s8jtxbe7nslowjy07iso37t0 foreign key (privilege_id) references eprivilege;
alter table eroleprivileges add constraint FKjpadfinkb8l3n2heyd6qtevkc foreign key (role_id) references erole;
alter table euser add constraint FKj6f4m4843kn10k1v1sevnkpj6 foreign key (person_id) references eperson;
alter table euserroles add constraint FK58ougg1i25tuyaoydgqpkllhv foreign key (module_id, role_id) references emoduleroles;
alter table euserroles add constraint FKie7pb8o5cr2d1p485ay32s98v foreign key (user_id) references euser;